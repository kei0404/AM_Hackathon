# Feature Specification: Data Plug Copilot - カーナビ連携スケジュール＆知識拡張アプリ

**Feature Branch**: `001-navi-schedule`
**Created**: 2025-01-27
**Updated**: 2025-01-17
**Status**: Draft
**Version**: 1.1.0

## 概要

Data Plug Copilotは、ユーザーのパーソナライズされた情報（スケジュール、移動履歴、嗜好）を「データプラグ」として車に装着し、AIエージェントが車を「ユーザー仕様」に変えるプロダクトです。

**コアバリュー**: 「移動の知恵（Data）」を「プラグ（Plug）」するだけで、すべてのドライバーが"その街の達人"に変わる。

---

## User Scenarios & Testing *(mandatory)*

### User Story 1 - スケジュールから自動的に行き先情報をカーナビに送信 (Priority: P1)

ユーザーはモバイル端末のスケジュールアプリに保存されている予定から、自動的に行き先情報を抽出し、カーナビに送信したいと考えています。ユーザーはアプリを開き、今日または指定した日付の予定を確認し、行き先情報を含む予定を選択してカーナビに送信します。

**Why this priority**: これはアプリのコア機能であり、ユーザーが最も頻繁に使用する主要な価値提供です。スケジュールから自動的に行き先を抽出することで、ユーザーは手動で行き先を入力する手間を省けます。

**Independent Test**: モバイル端末のスケジュールアプリに予定を追加し、アプリがその予定から行き先情報を抽出してカーナビに送信できることを確認できます。この機能単体で、ユーザーはスケジュールから行き先をカーナビに送信するという価値を得られます。

**Acceptance Scenarios**:

1. **Given** ユーザーがモバイル端末のスケジュールアプリに「会議 - 東京駅」という予定を保存している, **When** ユーザーがアプリを開いて今日の予定を表示し、その予定を選択してカーナビに送信する, **Then** アプリは「東京駅」を行き先として抽出し、カーナビに送信する
2. **Given** ユーザーが複数の予定をスケジュールに保存している, **When** ユーザーがアプリで特定の日付を選択し、その日の予定一覧を表示する, **Then** アプリは各予定から行き先情報を抽出して表示し、ユーザーが選択した予定をカーナビに送信できる
3. **Given** ユーザーが行き先情報を含まない予定（例：「電話会議」）をスケジュールに保存している, **When** ユーザーがその予定を選択してカーナビに送信しようとする, **Then** アプリは行き先情報が見つからないことをユーザーに通知し、手動で行き先を追加するオプションを提供する

---

### User Story 2 - 手動で行き先情報を追加してカーナビに送信 (Priority: P2)

ユーザーはスケジュールに含まれていない行き先を手動で入力し、カーナビに送信したいと考えています。ユーザーはアプリで「新しい行き先を追加」を選択し、住所や場所名を入力してカーナビに送信します。

**Why this priority**: スケジュールに含まれていない行き先や、急な予定に対応するために必要な機能です。これにより、アプリの実用性が大幅に向上します。

**Independent Test**: ユーザーがアプリで手動で行き先を入力し、カーナビに送信できることを確認できます。この機能単体で、ユーザーは任意の行き先をカーナビに送信するという価値を得られます。

**Acceptance Scenarios**:

1. **Given** ユーザーがアプリを開いている, **When** ユーザーが「新しい行き先を追加」を選択し、住所や場所名を入力してカーナビに送信する, **Then** アプリは入力された行き先情報をカーナビに送信する
2. **Given** ユーザーが過去に送信した行き先の履歴がある, **When** ユーザーが手動で行き先を追加しようとする, **Then** アプリは過去の行き先履歴を表示し、ユーザーが選択できるようにする

---

### User Story 3 - 複数の予定をまとめてカーナビに送信 (Priority: P3)

ユーザーは1日の複数の予定をまとめて確認し、順番にカーナビに送信したいと考えています。ユーザーはアプリで特定の日付を選択し、その日の複数の予定を確認し、順番にカーナビに送信します。

**Why this priority**: 1日に複数の予定がある場合、ユーザーが効率的に移動計画を立てられるようにする機能です。コア機能ではないため、P3とします。

**Independent Test**: ユーザーがアプリで複数の予定を選択し、順番にカーナビに送信できることを確認できます。この機能単体で、ユーザーは1日の移動計画を効率的に立てるという価値を得られます。

**Acceptance Scenarios**:

1. **Given** ユーザーが1日に複数の予定をスケジュールに保存している, **When** ユーザーがアプリでその日を選択し、複数の予定を選択して「順番に送信」を選択する, **Then** アプリは選択された予定を行き先として抽出し、順番にカーナビに送信する
2. **Given** ユーザーが複数の予定を選択している, **When** ユーザーが予定の順番を変更したい, **Then** アプリは予定の順番を変更する機能を提供する

---

### User Story 4 - AIエージェントによるスポット提案（Trend Stock機能） (Priority: P1)

ドライバー（特に新人）は、土地勘がなくても乗客に「今流行りのスポット」を提案したいと考えています。AIエージェントがSNSトレンドデータをもとに、リアルタイムで人気のスポットを提案します。

**Why this priority**: PRDのコアバリューである「すべてのドライバーがその街の達人に変わる」を実現する核心機能です。新人ドライバーでもベテランのような知識を持てるようになります。

**Independent Test**: アプリがSNSトレンド情報を取得し、ドライバーに対して現在地周辺の人気スポットを提案できることを確認できます。

**Acceptance Scenarios**:

1. **Given** ドライバーが特定のエリアで営業している, **When** 乗客が「どこかいい場所ある？」と質問する, **Then** AIエージェントが現在地周辺のSNSで話題のスポットを3つ以内で提案し、各スポットの人気理由を簡潔に説明する
2. **Given** AIエージェントがトレンドスポットを提案している, **When** ドライバーがスポットを選択する, **Then** システムは選択したスポットをカーナビに自動的に設定する
3. **Given** ネットワーク接続が不安定な状態, **When** ドライバーがトレンドスポットを要求する, **Then** システムはキャッシュされた最新のトレンドデータを使用して提案する

---

### User Story 5 - 移動履歴の蓄積と活用（Life Log Stock機能） (Priority: P1)

ドライバーは過去の移動履歴や訪問場所の記憶を「資産」として蓄積し、将来の移動に活用したいと考えています。システムは走行履歴、訪問先、その時の体験をローカルに保存し、必要な時に参照できます。

**Why this priority**: 「車に乗るたびに移動履歴がLife Logとして蓄積され、自分だけの最強のナビデータが育っていく」というPRDの核心価値を実現します。

**Independent Test**: ユーザーが過去に訪問した場所の履歴を確認し、その情報を基に行き先を選択できることを確認できます。

**Acceptance Scenarios**:

1. **Given** ドライバーが過去に何度も特定のルートを走行している, **When** 同じエリアで行き先を探す, **Then** システムは過去の走行履歴から関連する場所を優先的に提案する
2. **Given** ドライバーが訪問先で良い体験をした, **When** ドライバーが音声メモで体験を記録する, **Then** システムはその場所に関連付けてメモを保存し、次回提案時に参照できるようにする
3. **Given** ドライバーが車を乗り換えた, **When** 新しい車でアプリを使用する, **Then** ドライバーのLife Logデータは新しい車でも利用可能である（データポータビリティ）

---

### User Story 6 - ドライバーと乗客の会話ファシリテーション (Priority: P2)

ベテランドライバーは豊富な知識を持っているが、乗客との会話が苦手な場合があります。AIエージェントが乗客のニーズを察知し、ドライバーの知識を引き出すサポートをします。

**Why this priority**: PRDのPersona Bで定義されている「頑固なベテラン」のペインポイントを解決し、ドライバーの接客品質を向上させます。

**Independent Test**: AIエージェントが乗客との会話内容を分析し、ドライバーに適切な話題や提案をプロンプトできることを確認できます。

**Acceptance Scenarios**:

1. **Given** 乗客が「美味しい寿司が食べたい」と発言した, **When** ドライバーのLife Logにお気に入りの寿司店が記録されている, **Then** AIエージェントがドライバーに「〇〇の寿司屋、今なら空いているかもしれませんね」と水を向ける
2. **Given** 乗客が特定のジャンル（観光、グルメ等）に興味を示している, **When** AIがその興味を検知する, **Then** ドライバーのLife LogとTrend Stockから関連する情報を組み合わせて提案する
3. **Given** 運転中にAIが提案を行う, **When** ドライバーが確認する, **Then** 提案は「はい/いいえ」または3つ以内の選択肢で応答できる形式で表示される（運転中の安全配慮）

---

### Edge Cases

- スケジュールアプリへのアクセス権限が拒否された場合、アプリはどのように動作するか？
- カーナビが接続されていない、または利用できない場合、アプリはどのように動作するか？
- スケジュールから行き先情報を抽出できない場合（曖昧な表現、複数の可能性がある場合）、アプリはどのように動作するか？
- ユーザーがオフラインの場合、アプリはどのように動作するか？
- スケジュールに同じ場所への複数の予定がある場合、アプリはどのように処理するか？
- 予定の時間が過去の場合、アプリはどのように動作するか？
- **SNSトレンドデータが取得できない場合（API制限、ネットワーク障害）、システムはどのように動作するか？**
- **乗客がプライバシーを懸念して会話の分析を拒否した場合、システムはどのように動作するか？**
- **Life Logのストレージ容量が上限に達した場合、システムはどのように動作するか？**
- **AIの提案が不適切または不正確だった場合、ユーザーはどのようにフィードバックできるか？**

---

## Requirements *(mandatory)*

### Functional Requirements

#### 基本機能（スケジュール連携）

- **FR-001**: システムはモバイル端末のスケジュールアプリから予定情報を取得できなければならない
- **FR-002**: システムは予定情報から行き先情報（住所、場所名など）を抽出できなければならない
- **FR-003**: システムは抽出した行き先情報をカーナビに送信できなければならない
- **FR-004**: ユーザーは手動で行き先情報を入力してカーナビに送信できなければならない
- **FR-005**: システムは過去に送信した行き先情報の履歴を保存し、ユーザーが再利用できるようにしなければならない
- **FR-006**: システムは特定の日付の予定を表示できなければならない
- **FR-007**: システムは複数の予定を選択して順番にカーナビに送信できなければならない
- **FR-008**: システムは行き先情報が見つからない場合、ユーザーに通知し、手動で追加するオプションを提供しなければならない
- **FR-009**: システムはカーナビとの接続状態を確認し、接続できない場合にユーザーに通知しなければならない
- **FR-010**: システムはユーザーのプライバシー設定に従い、スケジュール情報へのアクセス権限を適切に管理しなければならない

#### Data Plug機能

- **FR-011**: システムはTrend Stock（SNS外部データ）を収集し、リアルタイムの「場所」情報を構造化して保存できなければならない
- **FR-012**: システムはLife Log Stock（内部データ）として走行履歴、訪問先、ユーザーのメモをローカルに蓄積できなければならない
- **FR-013**: システムはData Plug（知識源）を切り替え可能な形式で管理できなければならない
- **FR-014**: ユーザーはLife Logデータを他のデバイスまたは車両に移行（ポータビリティ）できなければならない

#### AIエージェント機能

- **FR-015**: AIエージェントはユーザーの発話内容を理解し、適切なStock（データベース）にアクセスして情報を検索できなければならない
- **FR-016**: AIエージェントは現在地周辺のトレンドスポットを提案できなければならない
- **FR-017**: AIエージェントはドライバーのLife Logから関連情報を検索し、会話のきっかけや提案の根拠を提示できなければならない
- **FR-018**: 運転中のAIからの提案は、簡潔な形式（はい/いいえ、または3つ以内の選択肢）で表示されなければならない
- **FR-019**: ユーザーは音声でAIエージェントに指示を出すことができなければならない

#### プライバシー・セキュリティ

- **FR-020**: Life Logデータはローカル（車載デバイスまたはユーザーのモバイル端末）に保存され、外部サーバーには送信されないこと
- **FR-021**: 乗客との会話データは適切にプライバシー加工（匿名化）されて保存されなければならない
- **FR-022**: ユーザーはいつでもLife Logデータを削除できなければならない

---

### Key Entities *(include if feature involves data)*

- **スケジュール/予定**: モバイル端末のスケジュールアプリに保存されている予定情報
  - 属性：タイトル、日時、場所、説明など

- **行き先情報**: カーナビに送信される目的地の情報
  - 属性：住所、場所名、緯度経度、カテゴリなど

- **カーナビ連携設定**: カーナビとの接続方法や送信形式に関する設定
  - 属性：接続方法、データ形式、認証情報など

- **行き先履歴**: 過去にカーナビに送信した行き先情報の履歴
  - 属性：行き先情報、送信日時、使用回数など

- **Trend Stock**: SNSから収集したリアルタイムの場所情報
  - 属性：場所名、住所、人気度スコア、トレンド理由、収集日時、情報ソースなど

- **Life Log Stock**: ユーザーの走行履歴と体験記録
  - 属性：訪問先、訪問日時、走行ルート、ユーザーメモ、体験評価など

- **Data Plug**: 切り替え可能な知識源の設定
  - 属性：プラグ種別（Trend/Life Log）、有効/無効状態、優先度設定など

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

#### 基本機能

- **SC-001**: ユーザーはスケジュールから行き先情報を抽出してカーナビに送信する操作を3ステップ以内で完了できる
- **SC-002**: システムはスケジュールから行き先情報を抽出する際、80%以上の精度で正しい行き先を識別できる
- **SC-003**: ユーザーは手動で行き先を入力してカーナビに送信する操作を2分以内で完了できる
- **SC-004**: システムはカーナビへの送信が成功した場合、90%以上の確率で正しく行き先が設定される
- **SC-005**: ユーザーは過去の行き先履歴から選択してカーナビに送信する操作を1ステップで完了できる
- **SC-006**: システムはカーナビとの接続に失敗した場合、5秒以内にユーザーに通知する

#### Data Plug機能

- **SC-007**: 新人ドライバーでもAIエージェントの提案を活用することで、乗客の「どこかいい場所ない？」という質問に30秒以内に回答できる
- **SC-008**: AIエージェントが提案するトレンドスポットの90%以上が、実際に営業中かつアクセス可能である
- **SC-009**: Life Logデータは車両を乗り換えても5分以内に新しい車両で利用可能になる

#### ユーザー体験

- **SC-010**: 運転中のAI操作は音声または片手で3秒以内に完了できる
- **SC-011**: AIエージェントの提案を利用したドライバーの80%が「役に立った」と評価する

---

## Assumptions

- モバイル端末は標準的なスケジュールアプリ（カレンダーアプリ）を使用している
- カーナビは標準的な連携プロトコル（Bluetooth、Wi-Fi、USBなど）をサポートしている
- ユーザーはモバイル端末とカーナビの両方にアクセス権限を持っている
- スケジュール情報には行き先情報がテキスト形式で含まれている（例：「会議 - 東京駅」「打ち合わせ - 渋谷区○○1-2-3」など）
- ユーザーはインターネット接続が利用可能な環境で使用することを想定しているが、オフライン時も基本的な機能は動作する
- **SNSトレンドデータの取得には適切なAPI利用権限が確保されている**
- **ローカルストレージにLife Logを保存するための十分な容量がある**
- **AIエージェントはOSS LLM（PRD推奨のQwenなど）を使用する**
- **タクシードライバーおよび一般ドライバーの両方をターゲットユーザーとする**

---

## 変更履歴

| 日付 | バージョン | 変更内容 | 変更理由 |
|------|------------|----------|----------|
| 2025-01-27 | 1.0.0 | 初版作成 | 初期要件定義 |
| 2025-01-17 | 1.1.0 | PRD「Data Plug Copilot」の情報を統合 | ハッカソン製品ビジョンとの整合性確保 |

### v1.1.0の主な変更点

**追加**:
- 製品概要セクションにData Plug Copilotのコアバリューを追加
- User Story 4: AIエージェントによるスポット提案（Trend Stock機能）
- User Story 5: 移動履歴の蓄積と活用（Life Log Stock機能）
- User Story 6: ドライバーと乗客の会話ファシリテーション
- FR-011〜FR-022: Data Plug機能、AIエージェント機能、プライバシー・セキュリティ要件
- Key Entities: Trend Stock、Life Log Stock、Data Plug
- SC-007〜SC-011: Data Plug機能とユーザー体験に関する成功基準
- Edge Cases: SNSデータ取得失敗、プライバシー拒否、ストレージ上限、AIフィードバック

**更新**:
- ドキュメントタイトルを「Data Plug Copilot - カーナビ連携スケジュール＆知識拡張アプリ」に変更
- Assumptionsにデータ取得権限、ストレージ、AIモデル、ターゲットユーザーに関する前提を追加
