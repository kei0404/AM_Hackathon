---
description: プロジェクトの実行計画（PLANS.md）を生成または更新するためのコマンドです。プロジェクトの現状を調査し、テンプレートに沿ったPLANS.mdを作成します。
allowed-tools:
  - functions.read_file
  - functions.write
  - functions.list_dir
  - functions.glob_file_search
  - functions.search_replace
---

##  Task
あなたはプロダクトマネージャーです。このプロジェクトで行うプロダクト開発の実行計画（PLANS.md）を作成してください。
このコマンドが呼び出されたら、以下の手順で動作してください。


### 作業手順
1. 作業対象のリポジトリルートを確認する（現在開いているワークスペースのルートを想定）。
2. ルートに `PLANS.md` が存在しない場合は新規作成し、存在する場合は **既存 PLANS.md があればテンプレートに沿った形で書き換え、差分をマージする**。
3. `PLANS.md` の形式は、後述する「PLANS.md フォーマット」と **完全に一致**させる。
4. 可能であれば `PLANS.md` を開き、先頭数行をユーザーにプレビューとして提示する。
5. 生成が完了したら、「PLANS.md をテンプレートに合わせて作成（または更新）した」ことを短く報告する。
  

### PLANS.md テンプレート: Structure
以下にCluadeCodeによる開発で参照する、`PLANS.md`を作成するためのルールを記述する。
PLANS.md は、以下の項目を必ず含むこと。

```
1. **メタデータブロック: Metadata Block**

- プロジェクト名
- バージョン番号
- ライセンス情報（指定された場合）

2. **PLANS.md の使用方法: How to use PLANS.md**

- 以下の文言は必ず入れる

```
- 実行可能仕様書（ExecPlan）を作成する際は、PLANS.md を忠実に守ってください。状況に合わない場合は、PLANS.md ファイル全体を読んで記憶を刷新してください。正確な仕様書を作成するには、原資料を徹底的に読み（そして再読し）、仕様書を作成してください。仕様書を作成する際は、骨組みから始めて、調査を進めながら具体化を進めてください。

- 実行可能仕様書（ExecPlan）を実装する際は、ユーザーに「次のステップ」を尋ねず、次のマイルストーンに進んでください。すべてのセクションを最新の状態に保ち、進捗状況と次のステップを明確に示すために、各段階でリストの項目を追加または分割してください。不明瞭な点は自主的に解決し、頻繁にコミットしてください。

- 実行可能仕様書（ExecPlan）について議論する際は、後世のために仕様書のログに決定事項を記録してください。仕様書に変更が加えられた理由が明確に記述されている必要があります。ExecPlan は生きた文書であり、他の作業なしに ExecPlan のみから再開できる必要があります。

- 困難な要件や重大な未知数を含む設計を調査する際には、マイルストーンを用いて概念実証や「トイ実装」などを実施し、ユーザーの提案が実現可能かどうかを検証します。ライブラリのソースコードを探したり入手したりして読み、徹底的に調査し、プロトタイプを組み込むことで、より完全な実装へと導きます。
```

3. **プロジェクトの目的/全体像: Purpose / Overview**

- プロジェクト目標の概要
- 中核となる価値提案
- このプロジェクトが解決する問題

4. **文脈と方向性: Context & Direction**

- 問題の背景
- 設計理念
- 主な制約
- 読者が何も知らないと仮定して、現在の状態を説明する。
- キーファイルをフルパスで指定。

5. **仕様: Specification**

- システム仕様
- アーキテクチャの決定
- 設計の詳細

6. **目標とする成果物: Target Deliverables**
- このプロジェクトの成果物を記述する
- spec.md を参照し、要件定義を満たすプロダクトを設定する

7. **進捗: Progress**
- チェックボックス付きリストが必須
- 停止するたびに完了/残存タスクを記録し、タイムスタンプを記録する


8. **驚きと発見: Surprises & Discoveries**
- 実装中に発見された予期せぬ挙動、バグ、洞察を短い証拠スニペットとともに文書化する

9. 決定ログ: Decision Log
- 日付を付した重要な決定事項
- 根拠と背景
- 考慮されたトレードオフ

10. **作業計画: Plan of Work**
- 編集と追加の順序
- 散文で具体的に記述
- ファイル名、関数、モジュール、変更内容を具体的に記述

11. **作業の具体的なステップと内容: Concrete Steps**
- 実行する正確なコマンド
- 作業ディレクトリ
- 予想される出力のトランスクリプト
- 読者が比較できるようにする

12. **未解決の質問**

- 未解決の質問
- 検討中の選択肢
- 阻害要因と不確実性

13. **成果と振り返り: Outcomes & Retrospective**
- 達成されたこと
- 課題
- 教訓を要約

14. 検証と受け入れ: Validation and Acceptance
検証はオプションではありません。
- システム起動方法
- 観察すべき動作
- テスト可能な受け入れ基準 (人が検証できる行動として記述)
- テストシナリオ 
- 成功指標

---
記入例：「テストコマンドを実行し、新しいテストが合格する」
---

15. 更新履歴

```

## PLANS.md 作成時の基本原則
### 4つの指導原則
自己完結型、自己充足型、初心者誘導型、成果重視型

**原則1 自己完結型**
- 相手に期待せず、自身がすべてを知っている状態にする。
- 前提知識ゼロでも大丈夫にします。

**原則2 自己充足型**
- 進捗に応じて書き換えていく、だが原則1の自己完結を必ず維持させる。

**原則3 初心者誘導型**
- 任せるということはしない、初心者に手取り足取り教えるように開発のレールをきっちりと敷く。

**原則4 成果重視型**
- 見た目の綺麗さなどとかよりも、きちんと動作することが大事。
- 目に見える結果で判断をする。

### ガイドライン

- 現在のプロジェクトの状況から収集した情報を基に作成する
- ユーザーの入力を参考にプロジェクトの範囲を把握する
- 簡潔かつ包括的に記述する
- 継続的に更新可能なドキュメントとしてフォーマットする
- 追跡可能なタスクには、マークダウン形式のチェックボックス ([ ]) を使用する
- **重要**: PLANS.md を作成する前に、プレビューを表示し、ユーザーの承認 (y/n) を得る

## 作成する上での注意点
- PLANS.md 本文は500行～600行程度に収める
- 本文が600行を超える場合は、内容別に別の .md ファイルを作成し、参照するようにする
- 別ファイルを作成する場合は、ユーザーに承認を受けるようにする
- `PLANS.md` に関連する別ファイルは、`./docs/plan-files` 内に保存する。
- `./docs/plan-files` が存在しなければ新しく作成する。
