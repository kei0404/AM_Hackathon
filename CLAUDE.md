# CLAUDE.md

このファイルは、Claude Code (claude.ai/code) がこのリポジトリで作業する際のガイダンスを提供します。

## プロジェクト概要

AM Hackathonプロジェクト - 「DataPlug Copilot」を開発中。プライバシー・バイ・デザインのパーソナル車両AIエージェントシステムで、ユーザーがパーソナライズされたデータを任意の車に持ち込み、セッション中のみ使用し、データを残さない仕組みです。

**コアコンセプト**: 「車がその瞬間だけあなたのものになる」- ユーザーデータはユーザーのデバイス（スマートフォン/外部ストレージ）に保持され、車は認可されたセッション中のみアクセスし、セッション終了時に車側の全データが破棄されます。

**主要な価値提案**:
- 意思決定サポート: 最大3回の質問で選択肢を絞り込み、単一の目的地に到達
- グループ合意形成: スマートフォン経由で同乗者の嗜好を収集（2問）し、各候補が誰のどのニーズを満たすかを説明
- プライバシー優先: データはユーザーに残り、車はステートレス、セッションスコープは明示的に制御
- メモリーレイヤー: ユーザーのピン/履歴は異なる車両間で永続化

## リポジトリ構造

これは仕様と計画に焦点を当てたリポジトリで、3つの主要なワークフローシステムがあります：

### `.specify/` - SpecKitフレームワーク
構造化された機能開発のためのテンプレートベースの仕様システム：
- `memory/constitution.md` - コーディング標準を定義するプロジェクト憲章（PEP 8、型ヒント、テスト要件）
- `templates/` - 仕様、計画、タスク、チェックリストのテンプレート
- `scripts/` - 自動化スクリプト

### `.cursor/commands/` - Cursor IDEコマンド
Cursor IDE用のSpecKitワークフローコマンド：
- `speckit.specify.md` - 機能仕様の作成
- `speckit.plan.md` - 実装計画の生成
- `speckit.tasks.md` - タスクの分解
- `speckit.checklist.md` - 検証チェックリストの生成
- `speckit.clarify.md` - 曖昧な要件の明確化
- `speckit.implement.md` - 実装ガイダンス
- `speckit.constitution.md` - プロジェクト憲章の更新
- `speckit.analyze.md` - 既存仕様の分析
- `speckit.taskstoissues.md` - タスクをイシューに変換

### `.claude/command/` - Claude Codeコマンド
Claude Code用の日本語ワークフローコマンド：
- `update_spec.md` - 新しい情報で要件仕様を更新
- `create-commit.md` - 規約に従ったgitコミットの作成
- `create-unittest.md` - ユニットテストの生成
- `create-integrationtest.md` - 統合テストの生成
- `e2e-test.md` - エンドツーエンドテスト
- `create-erd.md` - エンティティ関係図の生成
- `create-flowchart.md` - フローチャートの生成
- `create-sequence.md` - シーケンス図の生成
- `changelogs.md` - 変更履歴の生成
- `generate-plans.md` - 実装計画の生成
- `Identifying-todo.md` - TODOの識別
- その他...

### `specs/` - 機能仕様
ブランチ別に整理されたアクティブな機能仕様：
- `001-navi-schedule/` - カーナビ連携スケジュールアプリ仕様
  - `spec.md` - 要件定義
  - `checklists/requirements.md` - 品質検証チェックリスト

### `docs/` - プロジェクトドキュメント
- `Data Plug_Copilot_PRD.md` - プロダクト要件ドキュメント（ハッカソン提出物）
- `DataPlug_Copilot_Development_Plan.md` - 開発計画とMVP戦略
- `requirements/` - 要件ドキュメント

## 開発ワークフロー

### 仕様の作成/更新

このプロジェクトは構造化された仕様ワークフローに従います。機能に取り組む際：

1. **機能仕様**は `specs/[branch-name]/spec.md` に配置
2. `/update_spec` コマンド（`.claude/command/update_spec.md`経由）を使用して要件を更新
3. 品質検証チェックリストは `specs/[branch-name]/checklists/requirements.md` に自動生成

**仕様構造**（update_spec.mdより）：
- User Scenarios & Testing（必須）- 優先順位付きユーザーストーリー（P1, P2, P3）、Given/When/Then形式の受け入れシナリオ
- Requirements（必須）- 機能要件（FR-001, FR-002など）
- Key Entities（データが関与する場合）- データモデルと属性
- Success Criteria（必須）- 測定可能で技術に依存しない成果
- Edge Cases
- Assumptions

**重要なルール**：
- WHATとWHYに焦点を当て、HOWは避ける（技術スタック、API、コード構造は含めない）
- 開発者ではなく、ビジネスステークホルダー向けに書く
- 成功基準は測定可能で技術に依存しない必要がある（例：「ユーザーが3分以内にチェックアウトを完了」であり、「API応答時間 < 200ms」ではない）
- 最大3つの`[要確認]`明確化マーカー - スコープ/UXに影響する重要な決定のみ
- 仕様にチェックリストを埋め込まない（別ファイル）

### 品質検証

すべての仕様は実装に進む前に検証チェックリストをパスする必要があります：

**コンテンツ品質**：
- 実装詳細がない（言語、フレームワーク、API）
- ユーザー価値とビジネスニーズに焦点を当てている
- 非技術的なステークホルダー向けに書かれている
- すべての必須セクションが完成している

**要件の完全性**：
- `[要確認]`マーカーが残っていない
- 要件がテスト可能で明確である
- 成功基準が測定可能で技術に依存しない
- すべての受け入れシナリオが定義されている
- エッジケースが識別されている
- スコープが明確に境界付けられている

### 憲章と標準

プロジェクトは `.specify/memory/constitution.md`（v1.0.1）で定義された厳格なPythonコーディング標準に従います：

**基本原則**（必須）：
1. **PEP 8準拠** - コードは79文字、コメントは72文字の行長制限；インデントは4スペース；snake_case/PascalCase/UPPER_CASE命名
2. **型ヒント** - すべての関数シグネチャとクラス属性に型ヒントを含める必要がある（PEP 484/526）
3. **ドキュメント文字列規約** - すべてのモジュール、クラス、公開関数にドキュメント文字列が必要（PEP 257）；GoogleまたはNumPyスタイルを推奨
4. **エラーハンドリングとロギング** - 特定の例外を使用；`print`ではなく`logging`モジュールを使用；構造化ロギングを推奨
5. **テスト標準** - pytestフレームワーク；重要なパスで80%以上のカバレッジ；外部依存関係をモック化
6. **依存関係管理** - 固定バージョン付きrequirements.txt；各依存関係が必要な理由を文書化
7. **コード組織** - `__init__.py`を使用；循環インポートを避ける；単一責任の原則

**コードスタイルとフォーマット**：
- フォーマットには`black`を使用（79文字の行長制限）
- インポートの並び替えには`isort`を使用
- リンティングには`flake8`/`ruff`を使用
- 静的型チェックには`mypy`を使用
- Pre-commitフック：black、isort、flake8/ruff、mypy

**禁止事項**：
- 正当化なしの破壊的変更
- コード内のシークレット
- ハードコーディング

**バージョニングポリシー**（憲章）：
- MAJOR: 後方互換性のないガバナンス変更
- MINOR: 新しい原則または大幅な拡張
- PATCH: 明確化、文言修正、タイポ修正

憲章が更新された場合、変更は依存するテンプレートに伝播する必要があります。

## 言語

- プロジェクトドキュメントは主に日本語
- コードコメントとドキュメント文字列は日本語または英語（既存のパターンに従う）
- 仕様ドキュメント（`.claude/command/`、`specs/`）は日本語
- SpecKitテンプレート（`.cursor/commands/`）は日本語

## Gitワークフロー

- 現在のブランチ: `001-navi-schedule`
- メインブランチ: 現在の状態では明示的に定義されていない
- Conventional Commitsを推奨
- すべての変更にフィーチャーブランチを使用

## ハッカソンの主要な制約

**タイムライン**: 3日間のMVP開発
**MVPフォーカス**：
- 物理的なドングルなし（QRコード = 論理的なプラグイン）
- カスタムマップアプリなし（ピンレイヤーのみ）
- 90秒のデモシナリオが重要

**安全性とプライバシー設計**：
- 明示的な同意によるセッションベースのデータアクセス
- スコープ選択（ON/OFFが明確、いつでも取り消し可能）
- セッション終了時に車側データを破棄
- 運転中の最小限のインタラクション（Yes/No、3択）
- 必要に応じて匿名モードにフォールバック

**LLMの役割**：
- 曖昧な意図を制約に変換（短い会話）
- 合意形成の説明を生成（説得力のある）
- 理由付き候補推薦を提供（説明可能性）
- 運転中は短い文/選択肢のみ（長文なし）
- **決して**運転操作や安全性判断をLLMに委任しない（安全なフォールバック付きルールベースのガード）

## 一般的な開発コマンド

現在は実装がまだない仕様中心のリポジトリのため、一般的なコマンドは以下の通りです：

**仕様作業用**：
- 仕様を読む: `specs/[branch]/spec.md`でReadツールを使用
- 仕様を更新: `.claude/command/update_spec.md`のワークフローを参照
- 品質を検証: `specs/[branch]/checklists/requirements.md`を確認

**将来の実装用**（憲章に基づく）：
- コードをフォーマット: `black . && isort .`
- リンティングを実行: `flake8`または`ruff`
- 型チェック: `mypy .`
- テストを実行: `pytest`（カバレッジ付き: `pytest --cov`）
- 特定のテストを実行: `pytest path/to/test_file.py::test_function_name`

## Claude Code向けの注意事項

- 要件の更新を求められた場合、`.claude/command/update_spec.md`の構造化されたワークフローに従う
- 仕様は技術に依存せず、ユーザー価値に焦点を当てる必要がある
- 実装前の品質検証は必須
- 憲章のコンプライアンスは自動化ツールで強制される
- これは厳しいMVP制約のあるハッカソンプロジェクト - 完全な実装よりも実用的で実証可能な機能を優先
